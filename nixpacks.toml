# Railway Nixpacks configuration - Skip optional dependencies to prevent Neon driver
# The .npmrc file sets optional=false which prevents @neondatabase/serverless from installing

[phases.setup]
nixPkgs = ["nodejs_20", "npm-9_x"]

[phases.install]
cmds = [
  "npm install"
]

[phases.build]
# Override Railway's default build (which has rm -rf node_modules that conflicts with cache mount)
# npm ci already does a clean install, so no need to delete node_modules first
cmds = [
  "npm ci",
  "npm run build",
  "npm prune --production"
]

[start]
cmd = "NODE_ENV=production node dist/index.js"
